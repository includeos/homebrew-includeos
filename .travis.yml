os: osx
osx_image: xcode10.2

language: bash

git:
  depth: false

before_cache:
  - brew cleanup

cache:
  - directories:
    - $HOME/Library/Caches/Homebrew

before_install:
  - brew tap includeos/includeos

install:
  - brew install includeos
  - conan --version

before_script:
  - conan config install https://github.com/includeos/conan_config.git
  - git clone https://github.com/includeos/hello_world

script:
  - conan install hello_world -pr clang-6.0-macos-x86_64
  - source activate.sh
  - cmake -DFOR_PRODUCTION=OFF hello_world
  - cmake --build .
  - gtimeout 10 boot hello 2>&1 | tee hello.log  || true
  - |
    if grep -F "Running [ Hello world - OS included ]" hello.log
    then
      echo "Hello World -  Success! :)"
    else
      exit 1
    fi

after_script:
  - source deactivate.sh
